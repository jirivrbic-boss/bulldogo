<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Nastaven√≠ - Bulldogo.cz</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebase konfigurace
        const firebaseConfig = {
            apiKey: "AIzaSyA1FEmsY458LLKQLGcUaOVXsYr3Ii55QeQ",
            authDomain: "inzerio-inzerce.firebaseapp.com",
            projectId: "inzerio-inzerce",
            storageBucket: "inzerio-inzerce.firebasestorage.app",
            messagingSenderId: "262039290071",
            appId: "1:262039290071:web:30af0eb1c65cd75e307092",
            measurementId: "G-7VD0ZE08M3"
        };
        
        // Inicializace Firebase
        const app = initializeApp(firebaseConfig);
        const firebaseAuth = getAuth(app);
        const firebaseDb = getFirestore(app);
        
        // Export pro glob√°ln√≠ pou≈æit√≠
        window.firebaseApp = app;
        window.firebaseAuth = firebaseAuth;
        window.firebaseDb = firebaseDb;
    </script>
</head>
<body>
    <div class="container" style="max-width: 800px; margin: 50px auto; padding: 20px;">
        <h1>üß™ Test Nastaven√≠ Profilu</h1>
        
        <div class="test-section" style="margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
            <h2>1. Firebase P≈ôipojen√≠</h2>
            <div id="firebaseStatus">Kontroluji...</div>
            <button onclick="testFirebaseConnection()">Test Firebase</button>
        </div>

        <div class="test-section" style="margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
            <h2>2. Test Ukl√°d√°n√≠ Osobn√≠ch Informac√≠</h2>
            <div style="display: grid; gap: 10px; margin: 10px 0;">
                <input type="text" id="testFirstName" placeholder="K≈ôestn√≠ jm√©no" style="padding: 10px;">
                <input type="text" id="testLastName" placeholder="P≈ô√≠jmen√≠" style="padding: 10px;">
                <input type="email" id="testEmail" placeholder="Email" style="padding: 10px;">
                <input type="tel" id="testPhone" placeholder="Telefon" style="padding: 10px;">
                <input type="text" id="testCity" placeholder="Mƒõsto" style="padding: 10px;">
                <textarea id="testBio" placeholder="O mnƒõ" rows="3" style="padding: 10px;"></textarea>
            </div>
            <button onclick="testSavePersonal()">Test Ulo≈æen√≠</button>
            <div id="personalResult"></div>
        </div>

        <div class="test-section" style="margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
            <h2>3. Test Obchodn√≠ch Informac√≠</h2>
            <div style="display: grid; gap: 10px; margin: 10px 0;">
                <input type="text" id="testBusinessName" placeholder="N√°zev firmy" style="padding: 10px;">
                <input type="text" id="testBusinessIco" placeholder="Iƒå" style="padding: 10px;">
                <input type="text" id="testBusinessDic" placeholder="DIƒå" style="padding: 10px;">
                <textarea id="testBusinessAddress" placeholder="Adresa firmy" rows="2" style="padding: 10px;"></textarea>
            </div>
            <button onclick="testSaveBusiness()">Test Ulo≈æen√≠ Obchodn√≠ch Informac√≠</button>
            <div id="businessResult"></div>
        </div>

        <div class="test-section" style="margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
            <h2>4. Test Naƒçten√≠ Dat</h2>
            <button onclick="testLoadData()">Naƒç√≠st Data</button>
            <div id="loadResult"></div>
        </div>

        <div class="test-section" style="margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
            <h2>4. Test Real-time Listener</h2>
            <button onclick="testRealtimeListener()">Spustit Listener</button>
            <button onclick="stopRealtimeListener()">Zastavit Listener</button>
            <div id="realtimeResult"></div>
        </div>

        <div class="test-section" style="margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
            <h2>5. Test Zmƒõny Hesla</h2>
            <div style="display: grid; gap: 10px; margin: 10px 0;">
                <input type="password" id="testCurrentPassword" placeholder="Souƒçasn√© heslo" style="padding: 10px;">
                <input type="password" id="testNewPassword" placeholder="Nov√© heslo" style="padding: 10px;">
                <input type="password" id="testConfirmPassword" placeholder="Potvrdit heslo" style="padding: 10px;">
            </div>
            <button onclick="testChangePassword()">Test Zmƒõny Hesla</button>
            <div id="passwordResult"></div>
        </div>

        <div class="test-section" style="margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
            <h2>6. Test Prefilled Funkcionality</h2>
            <p>Testuje, zda se formul√°≈ô v≈ædy napln√≠ aktu√°ln√≠mi daty u≈æivatele:</p>
            <button onclick="testPrefilledData()">Test Prefilled Data</button>
            <div id="prefilledResult"></div>
        </div>

        <div class="test-section" style="margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
            <h2>7. P≈ôesmƒõrov√°n√≠ na Nastaven√≠</h2>
            <button onclick="window.location.href='profile-settings.html'" style="background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
                Otev≈ô√≠t Nastaven√≠
            </button>
        </div>
    </div>

    <script>
        let realtimeListener = null;

        // Test Firebase p≈ôipojen√≠
        async function testFirebaseConnection() {
            const statusDiv = document.getElementById('firebaseStatus');
            try {
                if (window.firebaseAuth && window.firebaseDb) {
                    const currentUser = window.firebaseAuth.currentUser;
                    statusDiv.innerHTML = `
                        <div style="color: green;">
                            ‚úÖ Firebase p≈ôipojen<br>
                            Auth: ${!!window.firebaseAuth}<br>
                            DB: ${!!window.firebaseDb}<br>
                            U≈æivatel: ${currentUser ? currentUser.email : 'Nen√≠ p≈ôihl√°≈°en'}
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = '<div style="color: red;">‚ùå Firebase nen√≠ p≈ôipojen</div>';
                }
            } catch (error) {
                statusDiv.innerHTML = `<div style="color: red;">‚ùå Chyba: ${error.message}</div>`;
            }
        }

        // Test ukl√°d√°n√≠ osobn√≠ch informac√≠
        async function testSavePersonal() {
            const resultDiv = document.getElementById('personalResult');
            try {
                const currentUser = window.firebaseAuth.currentUser;
                if (!currentUser) {
                    resultDiv.innerHTML = '<div style="color: red;">‚ùå Mus√≠te b√Ωt p≈ôihl√°≈°eni</div>';
                    return;
                }

                const firstName = document.getElementById('testFirstName').value;
                const lastName = document.getElementById('testLastName').value;

                const personalData = {
                    firstName: firstName,
                    lastName: lastName,
                    name: `${firstName} ${lastName}`.trim(),
                    email: document.getElementById('testEmail').value,
                    phone: document.getElementById('testPhone').value,
                    city: document.getElementById('testCity').value,
                    bio: document.getElementById('testBio').value,
                    updatedAt: new Date()
                };

                const { setDoc, doc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const profileRef = doc(window.firebaseDb, 'users', currentUser.uid, 'profile', 'profile');
                
                await setDoc(profileRef, personalData, { merge: true });

                resultDiv.innerHTML = `
                    <div style="color: green;">
                        ‚úÖ Data √∫spƒõ≈°nƒõ ulo≈æena<br>
                        <pre>${JSON.stringify(personalData, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: red;">‚ùå Chyba: ${error.message}</div>`;
            }
        }

        // Test ukl√°d√°n√≠ obchodn√≠ch informac√≠
        async function testSaveBusiness() {
            const resultDiv = document.getElementById('businessResult');
            try {
                const currentUser = window.firebaseAuth.currentUser;
                if (!currentUser) {
                    resultDiv.innerHTML = '<div style="color: red;">‚ùå Mus√≠te b√Ωt p≈ôihl√°≈°eni</div>';
                    return;
                }

                const businessData = {
                    businessName: document.getElementById('testBusinessName').value,
                    businessIco: document.getElementById('testBusinessIco').value,
                    businessDic: document.getElementById('testBusinessDic').value,
                    businessAddress: document.getElementById('testBusinessAddress').value,
                    updatedAt: new Date()
                };

                const { setDoc, doc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const profileRef = doc(window.firebaseDb, 'users', currentUser.uid, 'profile', 'profile');
                
                await setDoc(profileRef, businessData, { merge: true });

                resultDiv.innerHTML = `
                    <div style="color: green;">
                        ‚úÖ Obchodn√≠ informace √∫spƒõ≈°nƒõ ulo≈æeny<br>
                        <pre>${JSON.stringify(businessData, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: red;">‚ùå Chyba: ${error.message}</div>`;
            }
        }

        // Test naƒçten√≠ dat
        async function testLoadData() {
            const resultDiv = document.getElementById('loadResult');
            try {
                const currentUser = window.firebaseAuth.currentUser;
                if (!currentUser) {
                    resultDiv.innerHTML = '<div style="color: red;">‚ùå Mus√≠te b√Ωt p≈ôihl√°≈°eni</div>';
                    return;
                }

                const { getDoc, doc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const profileRef = doc(window.firebaseDb, 'users', currentUser.uid, 'profile', 'profile');
                const profileSnap = await getDoc(profileRef);
                
                if (profileSnap.exists()) {
                    const data = profileSnap.data();
                    resultDiv.innerHTML = `
                        <div style="color: green;">
                            ‚úÖ Data naƒçtena<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                    
                    // Naplnit formul√°≈ô
                    document.getElementById('testFirstName').value = data.firstName || '';
                    document.getElementById('testLastName').value = data.lastName || '';
                    document.getElementById('testEmail').value = data.email || '';
                    document.getElementById('testPhone').value = data.phone || '';
                    document.getElementById('testCity').value = data.city || '';
                    document.getElementById('testBio').value = data.bio || '';
                    document.getElementById('testBusinessName').value = data.businessName || '';
                    document.getElementById('testBusinessIco').value = data.businessIco || '';
                    document.getElementById('testBusinessDic').value = data.businessDic || '';
                    document.getElementById('testBusinessAddress').value = data.businessAddress || '';
                } else {
                    resultDiv.innerHTML = '<div style="color: orange;">‚ö†Ô∏è ≈Ω√°dn√° data nenalezena</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: red;">‚ùå Chyba: ${error.message}</div>`;
            }
        }

        // Test real-time listener
        async function testRealtimeListener() {
            const resultDiv = document.getElementById('realtimeResult');
            try {
                const currentUser = window.firebaseAuth.currentUser;
                if (!currentUser) {
                    resultDiv.innerHTML = '<div style="color: red;">‚ùå Mus√≠te b√Ωt p≈ôihl√°≈°eni</div>';
                    return;
                }

                const { onSnapshot, doc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const profileRef = doc(window.firebaseDb, 'users', currentUser.uid, 'profile', 'profile');
                
                realtimeListener = onSnapshot(profileRef, (snapshot) => {
                    if (snapshot.exists()) {
                        const data = snapshot.data();
                        resultDiv.innerHTML = `
                            <div style="color: blue;">
                                üîÑ Real-time aktualizace:<br>
                                <pre>${JSON.stringify(data, null, 2)}</pre>
                            </div>
                        `;
                    }
                }, (error) => {
                    resultDiv.innerHTML = `<div style="color: red;">‚ùå Listener chyba: ${error.message}</div>`;
                });

                resultDiv.innerHTML = '<div style="color: green;">‚úÖ Real-time listener spu≈°tƒõn</div>';
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: red;">‚ùå Chyba: ${error.message}</div>`;
            }
        }

        // Zastavit real-time listener
        function stopRealtimeListener() {
            if (realtimeListener) {
                realtimeListener();
                realtimeListener = null;
                document.getElementById('realtimeResult').innerHTML = '<div style="color: orange;">‚ö†Ô∏è Listener zastaven</div>';
            }
        }

        // Test zmƒõny hesla
        async function testChangePassword() {
            const resultDiv = document.getElementById('passwordResult');
            try {
                const currentUser = window.firebaseAuth.currentUser;
                if (!currentUser) {
                    resultDiv.innerHTML = '<div style="color: red;">‚ùå Mus√≠te b√Ωt p≈ôihl√°≈°eni</div>';
                    return;
                }

                const currentPassword = document.getElementById('testCurrentPassword').value;
                const newPassword = document.getElementById('testNewPassword').value;
                const confirmPassword = document.getElementById('testConfirmPassword').value;

                if (!currentPassword || !newPassword || !confirmPassword) {
                    resultDiv.innerHTML = '<div style="color: red;">‚ùå Vypl≈àte v≈°echna pole</div>';
                    return;
                }

                if (newPassword !== confirmPassword) {
                    resultDiv.innerHTML = '<div style="color: red;">‚ùå Nov√° hesla se neshoduj√≠</div>';
                    return;
                }

                if (newPassword.length < 6) {
                    resultDiv.innerHTML = '<div style="color: red;">‚ùå Nov√© heslo mus√≠ m√≠t alespo≈à 6 znak≈Ø</div>';
                    return;
                }

                // Re-autentifikace
                const { reauthenticateWithCredential, EmailAuthProvider } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
                const credential = EmailAuthProvider.credential(currentUser.email, currentPassword);
                await reauthenticateWithCredential(currentUser, credential);

                // Zmƒõna hesla
                const { updatePassword } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
                await updatePassword(currentUser, newPassword);

                // Vyƒçistit formul√°≈ô
                document.getElementById('testCurrentPassword').value = '';
                document.getElementById('testNewPassword').value = '';
                document.getElementById('testConfirmPassword').value = '';

                resultDiv.innerHTML = '<div style="color: green;">‚úÖ Heslo √∫spƒõ≈°nƒõ zmƒõnƒõno</div>';
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: red;">‚ùå Chyba: ${error.message}</div>`;
            }
        }

        // Test prefilled funkcionality
        async function testPrefilledData() {
            const resultDiv = document.getElementById('prefilledResult');
            try {
                const currentUser = window.firebaseAuth.currentUser;
                if (!currentUser) {
                    resultDiv.innerHTML = '<div style="color: red;">‚ùå Mus√≠te b√Ωt p≈ôihl√°≈°eni</div>';
                    return;
                }

                const { getDoc, doc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                const profileRef = doc(window.firebaseDb, 'users', currentUser.uid, 'profile', 'profile');
                const profileSnap = await getDoc(profileRef);
                
                if (profileSnap.exists()) {
                    const data = profileSnap.data();
                    resultDiv.innerHTML = `
                        <div style="color: green;">
                            ‚úÖ Prefilled data nalezena:<br>
                            <strong>K≈ôestn√≠ jm√©no:</strong> ${data.firstName || 'Nen√≠ vyplnƒõno'}<br>
                            <strong>P≈ô√≠jmen√≠:</strong> ${data.lastName || 'Nen√≠ vyplnƒõno'}<br>
                            <strong>Cel√© jm√©no:</strong> ${data.name || 'Nen√≠ vyplnƒõno'}<br>
                            <strong>Email:</strong> ${data.email || 'Nen√≠ vyplnƒõno'}<br>
                            <strong>Telefon:</strong> ${data.phone || 'Nen√≠ vyplnƒõno'}<br>
                            <strong>Mƒõsto:</strong> ${data.city || 'Nen√≠ vyplnƒõno'}<br>
                            <strong>Bio:</strong> ${data.bio || 'Nen√≠ vyplnƒõno'}<br>
                            <strong>Firma:</strong> ${data.businessName || 'Nen√≠ vyplnƒõno'}<br>
                            <strong>Iƒå:</strong> ${data.businessIco || 'Nen√≠ vyplnƒõno'}<br>
                            <strong>DIƒå:</strong> ${data.businessDic || 'Nen√≠ vyplnƒõno'}<br>
                            <br>
                            <em>Tyto hodnoty se automaticky napln√≠ do formul√°≈ôe p≈ôi otev≈ôen√≠ str√°nky nastaven√≠.</em>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div style="color: orange;">
                            ‚ö†Ô∏è ≈Ω√°dn√Ω profil nenalezen - bude vytvo≈ôen z√°kladn√≠ profil s aktu√°ln√≠mi daty u≈æivatele:<br>
                            <strong>Email:</strong> ${currentUser.email}<br>
                            <strong>Jm√©no:</strong> ${currentUser.displayName || currentUser.email.split('@')[0]}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div style="color: red;">‚ùå Chyba: ${error.message}</div>`;
            }
        }

        // Inicializace
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üß™ Test str√°nka naƒçtena');
            testFirebaseConnection();
        });
    </script>
</body>
</html>